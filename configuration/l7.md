# L7 Firewall Configuration

The `l7` section configures application-layer firewall rules evaluated in priority order (first-match-wins).

## Reference

```yaml
l7:
  rules:
    - id: "rule-id"
      priority: 10
      action: deny             # allow or deny
      protocol: http           # http, tls, grpc, smtp, ftp, smb
      # Protocol-specific fields (all optional):
      path: "/admin"           # HTTP path (regex)
      method: "POST"           # HTTP method
      host: "*.example.com"    # HTTP host
      sni: "*.malware.com"     # TLS Server Name Indication
      service: "pkg.Service"   # gRPC service
      share: "C$"              # SMB share name
      description: "Rule description"
```

## Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | `string` | Yes | Unique identifier |
| `priority` | `integer` | Yes | Evaluation order (lowest = first) |
| `action` | `string` | Yes | `allow` or `deny` |
| `protocol` | `string` | Yes | `http`, `tls`, `grpc`, `smtp`, `ftp`, `smb` |
| `description` | `string` | No | Human-readable description |

### Protocol-Specific Fields

| Protocol | Available Fields |
|----------|-----------------|
| `http` | `path`, `method`, `host`, `headers`, `user_agent` |
| `tls` | `sni` |
| `grpc` | `service`, `method` |
| `smtp` | `sender`, `recipient`, `command` |
| `ftp` | `command`, `path` |
| `smb` | `share`, `command` |

## Examples

### Web application protection

```yaml
l7:
  rules:
    - id: block-admin
      priority: 10
      action: deny
      protocol: http
      path: "/admin.*"
      description: "Block admin panel"
    - id: block-internal-api
      priority: 20
      action: deny
      protocol: http
      path: "/api/internal/.*"
      description: "Block internal APIs"
    - id: block-bad-sni
      priority: 30
      action: deny
      protocol: tls
      sni: "*.malware-domain.com"
    - id: block-admin-share
      priority: 40
      action: deny
      protocol: smb
      share: "C$"
      description: "Block admin share access"
```
